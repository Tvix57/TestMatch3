{"version":3,"sources":["file:///F:/git/TestMatch3/assets/Scripts/Session/GameSaveListener.ts"],"names":["GameSaveListener","constructor","_saveDisp","_logic","_adsContext","_store","_tutorial","_device","_statistic","_state","AddHandler","RemoveHandler","WillSave","gameState","adsState","storeState","tutorialStages","ResolveTutorialProgress","GetAll","OnPauseApplication","Save","OnStepChanged","GetRunningStage","undefined","ManualSave","OnResumeApplication"],"mappings":";;;8BAiBaA,gB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAjBb;AACA;AACA;AACA;AACA;AACA;;;kCAYaA,gB,GAAN,MAAMA,gBAAN,CACP;AACIC,QAAAA,WAAW,CACCC,SADD,EAECC,MAFD,EAGCC,WAHD,EAICC,MAJD,EAKCC,SALD,EAMCC,OAND,EAOCC,UAPD,EAQCC,MARD,EAST;AAAA,eARUP,SAQV,GARUA,SAQV;AAAA,eAPUC,MAOV,GAPUA,MAOV;AAAA,eANUC,WAMV,GANUA,WAMV;AAAA,eALUC,MAKV,GALUA,MAKV;AAAA,eAJUC,SAIV,GAJUA,SAIV;AAAA,eAHUC,OAGV,GAHUA,OAGV;AAAA,eAFUC,UAEV,GAFUA,UAEV;AAAA,eADUC,MACV,GADUA,MACV;;AACEP,UAAAA,SAAS,CAACQ,UAAV,CAAqB,IAArB;;AACAH,UAAAA,OAAO,CAACG,UAAR,CAAmB,IAAnB;;AACAJ,UAAAA,SAAS,CAACI,UAAV,CAAqB,IAArB;AACH;;AACDC,QAAAA,aAAa,GAAE;AACX,eAAKT,SAAL,CAAeS,aAAf,CAA6B,IAA7B;;AACA,eAAKJ,OAAL,CAAaI,aAAb,CAA2B,IAA3B;;AACA,eAAKL,SAAL,CAAeK,aAAf,CAA6B,IAA7B;AACH;;AAEDC,QAAAA,QAAQ,GAAS;AACb,eAAKT,MAAL,CAAYS,QAAZ,CAAqB,KAAKH,MAAL,CAAYI,SAAjC;;AACA,eAAKT,WAAL,CAAiBQ,QAAjB,CAA0B,KAAKH,MAAL,CAAYK,QAAtC;;AACA,eAAKT,MAAL,CAAYO,QAAZ,CAAqB,KAAKH,MAAL,CAAYM,UAAjC;;AACA,eAAKP,UAAL,CAAgBI,QAAhB;;AACA,eAAKH,MAAL,CAAYI,SAAZ,CAAuBG,cAAvB,GAAwC,KAAKV,SAAL,CAAeW,uBAAf,GAAyCC,MAAzC,EAAxC;AACH;;AACDC,QAAAA,kBAAkB,GAAS;AACvB,eAAKjB,SAAL,CAAekB,IAAf;AACH;;AAEDC,QAAAA,aAAa,GAAO;AAChB,cAAG,KAAKf,SAAL,CAAegB,eAAf,MAAoCC,SAAvC,EACI,KAAKrB,SAAL,CAAekB,IAAf;AACP;;AACDI,QAAAA,UAAU,GAAG;AAAE,eAAKtB,SAAL,CAAekB,IAAf;AAAuB;;AACtCK,QAAAA,mBAAmB,GAAS,CAAG;;AArCnC,O","sourcesContent":["/**\r\n * \r\n * GameSaveListener.ts\r\n * db://assets/Scripts/Session/GameSaveListener.ts\r\n *\r\n */\r\n\r\nimport { AdsContext } from \"../Ads/AdsContext\";\r\nimport { AppDevice, IApplicationHandler } from \"../Application/AppDevice\";\r\nimport { GameLogic } from \"../Game/GameLogic\";\r\nimport { SaveDispatcher } from \"../Save/SaveDispatcher\";\r\nimport { ISaveListener } from \"../Save/SaveInterfaces\";\r\nimport { ApplicationState } from \"../Save/State\";\r\nimport { StatisticAgregator } from \"../Statistic/StatisticAgregator\";\r\nimport { StoreContext } from \"../Store/StoreContext\";\r\nimport { ITutorialHandler, TutorialContext } from \"../Tutorial/TutorialContext\";\r\n\r\nexport class GameSaveListener implements ISaveListener,IApplicationHandler,ITutorialHandler\r\n{\r\n    constructor(\r\n        private _saveDisp:SaveDispatcher,\r\n        private _logic:GameLogic,\r\n        private _adsContext:AdsContext,\r\n        private _store:StoreContext,\r\n        private _tutorial:TutorialContext,\r\n        private _device:AppDevice,\r\n        private _statistic:StatisticAgregator,\r\n        private _state:ApplicationState\r\n    ) {\r\n        _saveDisp.AddHandler(this)\r\n        _device.AddHandler(this)\r\n        _tutorial.AddHandler(this)\r\n    }\r\n    RemoveHandler(){\r\n        this._saveDisp.RemoveHandler(this)\r\n        this._device.RemoveHandler(this)\r\n        this._tutorial.RemoveHandler(this)\r\n    }\r\n    \r\n    WillSave(): void {\r\n        this._logic.WillSave(this._state.gameState!)\r\n        this._adsContext.WillSave(this._state.adsState)\r\n        this._store.WillSave(this._state.storeState)\r\n        this._statistic.WillSave()\r\n        this._state.gameState!.tutorialStages = this._tutorial.ResolveTutorialProgress().GetAll()\r\n    }\r\n    OnPauseApplication(): void {\r\n        this._saveDisp.Save()\r\n    }\r\n    \r\n    OnStepChanged():void{\r\n        if(this._tutorial.GetRunningStage() == undefined) \r\n            this._saveDisp.Save()\r\n    }\r\n    ManualSave() { this._saveDisp.Save() }\r\n    OnResumeApplication(): void { }\r\n}"]}