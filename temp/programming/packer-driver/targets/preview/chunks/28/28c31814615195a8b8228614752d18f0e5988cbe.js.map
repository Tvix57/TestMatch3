{"version":3,"sources":["file:///F:/git/TestMatch3/assets/Scripts/Scene/GameScene/GameSceneComponent.ts"],"names":["_decorator","Component","instantiate","Label","Node","Prefab","UITransform","GameScenePresenter","AppRoot","BallComponent","ccclass","property","GameSceneComponent","_presenter","_balls","onEnable","getInstance","ResolveGameContext","ResolveGame","ResolveField","ResovleSaveState","ResolveSaveContext","GetCurrentSaveState","LoadData","SetName","newName","nameLabel","string","UpdateScore","newScore","scoreLabel","UpdateField","newfield","fromOutside","length","Array","fill","map","forEach","row","i","color","j","ballPrefab","getComponent","SetColor","field","addChild","setBallsPosition","ball","node","x","y","nodeSize","position","set","width","height","hideBall"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, Node, Prefab, UITransform } from 'cc';\r\nimport { GameScenePresenter } from './GameScenePresenter';\r\nimport { AppRoot } from '../../Application/AppRoot';\r\nimport { BallColor } from '../../Enums/BallColor';\r\nimport { BallComponent } from './BallComponent';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('GameSceneComponent')\r\nexport class GameSceneComponent extends Component {\r\n    @property(Label)\r\n    nameLabel: Label = null!\r\n\r\n    @property(Label)\r\n    scoreLabel: Label = null!\r\n\r\n    @property(Node)\r\n    field: Node = null!\r\n\r\n    @property(Prefab)\r\n    ballPrefab: Prefab = null!\r\n\r\n    private _presenter?: GameScenePresenter\r\n    private _balls: Array<Array<Node>> = []\r\n\r\n    onEnable(): void {\r\n        this._presenter = new GameScenePresenter(this, \r\n                                                 AppRoot.getInstance.ResolveGameContext().ResolveGame().ResolveField(),\r\n                                                 AppRoot.getInstance.ResovleSaveState().ResolveSaveContext().GetCurrentSaveState())\r\n\r\n        this._presenter!.LoadData()\r\n    }\r\n\r\n    SetName(newName: string) {\r\n        this.nameLabel.string = newName\r\n    }\r\n\r\n    UpdateScore(newScore: string) { \r\n        this.scoreLabel.string = newScore\r\n    }\r\n\r\n    UpdateField(newfield: Array<Array<BallColor>>, fromOutside?: boolean) { \r\n        if (this._balls.length != newfield.length) {\r\n            this._balls = new Array(newfield.length).fill(null).map(() => new Array(newfield.length).fill(null));\r\n            newfield.forEach((row, i) => {\r\n                row.forEach((color, j) => {\r\n                    this._balls[i][j] = instantiate(this.ballPrefab)\r\n                    this._balls[i][j].getComponent(BallComponent)?.SetColor(color)\r\n                    this.field.addChild(this._balls[i][j])\r\n                    this.setBallsPosition(this._balls[i][j], i, j)\r\n                })\r\n            })\r\n        } else {\r\n            this._balls.forEach((row, i) => {\r\n                row.forEach((ball, j) => {\r\n                    if (fromOutside) {\r\n                        \r\n                    }\r\n                })\r\n            })\r\n        }\r\n    }\r\n\r\n    private setBallsPosition(node: Node, x: number, y: number) {\r\n        const nodeSize = node.getComponent(UITransform)!\r\n        node.position.set(nodeSize.width / 2 + (x * nodeSize.width),\r\n                          nodeSize.height / 2 + (y * nodeSize.height),\r\n                          0)\r\n    }\r\n\r\n    private hideBall(node: Node) {\r\n\r\n    }\r\n}\r\n\r\n\r\n"]}