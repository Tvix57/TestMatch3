{"version":3,"sources":["file:///F:/git/TestMatch3/assets/Scripts/Scene/GameScene/GameSceneComponent.ts"],"names":["_decorator","Component","instantiate","Label","Prefab","tween","UITransform","Vec3","GameScenePresenter","AppRoot","BallComponent","ccclass","property","GameSceneComponent","_presenter","_balls","animation","onEnable","getInstance","ResolveGameContext","ResolveGame","ResolveField","ResovleSaveState","ResolveSaveContext","GetCurrentSaveState","LoadData","onDisable","SaveCurrentGame","SetName","newName","nameLabel","string","UpdateScore","newScore","scoreLabel","ShowNewField","data","length","Array","fill","map","forEach","row","i","color","j","ballPrefab","field","node","addChild","addBallTween","x","getComponent","width","y","height","SetColor","start","RemoveBalls","DropDownBalls","to","from","setPosition","addAninm","position","parallel","hideBall"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, Node, Prefab, tween, Tween, UITransform, Vec3 } from 'cc';\r\nimport { GameScenePresenter } from './GameScenePresenter';\r\nimport { AppRoot } from '../../Application/AppRoot';\r\nimport { BallColor } from '../../Enums/BallColor';\r\nimport { BallComponent } from './BallComponent';\r\nimport { AnimationType } from '../../Logic/Field';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('GameSceneComponent')\r\nexport class GameSceneComponent extends Component {\r\n    @property(Label)\r\n    nameLabel: Label = null!\r\n\r\n    @property(Label)\r\n    scoreLabel: Label = null!\r\n\r\n    @property(UITransform)\r\n    field: UITransform = null!\r\n\r\n    @property(Prefab)\r\n    ballPrefab: Prefab = null!\r\n\r\n    private _presenter?: GameScenePresenter\r\n    private _balls: Array<Array<Node>> = []\r\n    private animation?: Tween<Node>\r\n\r\n    onEnable(): void {\r\n        this._presenter = new GameScenePresenter(this, \r\n                                                 AppRoot.getInstance.ResolveGameContext().ResolveGame().ResolveField(),\r\n                                                 AppRoot.getInstance.ResovleSaveState().ResolveSaveContext().GetCurrentSaveState())\r\n\r\n        this._presenter!.LoadData()\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        this._presenter?.SaveCurrentGame()\r\n    }\r\n\r\n    SetName(newName: string) {\r\n        this.nameLabel.string = newName\r\n    }\r\n\r\n    UpdateScore(newScore: string) { \r\n        this.scoreLabel.string = newScore\r\n    }\r\n\r\n    ShowNewField(data: Array<Array<BallColor>>) {\r\n        if (!this._balls.length) {\r\n            this._balls = new Array(data.length).fill(null).map(() => new Array(data.length).fill(null));\r\n            data.forEach((row, i) => {\r\n                row.forEach((color, j) => {\r\n                    this._balls[i][j] = instantiate(this.ballPrefab)\r\n                    this.field.node.addChild(this._balls[i][j])\r\n                })\r\n            })\r\n        } \r\n        data.forEach((row, i) => {\r\n            row.forEach((color, j) => {\r\n                this.addBallTween(this._balls[i][j],\r\n                   {x:this._balls[i][j].getComponent(UITransform)!.width  /2  * (i+1), \r\n                    y:this._balls[i][j].getComponent(UITransform)!.height /2  * (j+1)},\r\n                   {x:this._balls[i][j].getComponent(UITransform)!.width  /2  * (i+1), \r\n                    y:this.field.height + this._balls[i][j].getComponent(UITransform)!.height /2  * (j+1)})\r\n                this._balls[i][j].getComponent(BallComponent)?.SetColor(color)\r\n            })\r\n        })\r\n        \r\n        this.animation?.start()\r\n    }\r\n\r\n    RemoveBalls(data: Array<Array<BallColor>>) {\r\n        \r\n    }\r\n\r\n    DropDownBalls(data: Array<Array<BallColor>>) {\r\n\r\n    }\r\n\r\n    private addBallTween(node: Node, to:{x: number, y: number}, from?:{x: number, y: number},) {\r\n        if (from) {\r\n            node.setPosition(from.x, from.y, 0)\r\n        }\r\n        let addAninm = tween(node)\r\n            .to(0.5, { position: new Vec3(to.x, to.y, 0) })\r\n        if (this.animation) {\r\n            this.animation = this.animation.parallel(addAninm, this.animation)\r\n        } else {\r\n            this.animation = addAninm\r\n        }\r\n    }\r\n\r\n    private hideBall(node: Node) {\r\n\r\n    }\r\n}\r\n\r\n\r\n"]}